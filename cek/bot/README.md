# CEK Telegram Bot

–ù–µ–∑–∞–ª–µ–∂–Ω–∏–π Telegram –±–æ—Ç –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≥—Ä–∞—Ñ—ñ–∫—ñ–≤ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å –µ–ª–µ–∫—Ç—Ä–æ–µ–Ω–µ—Ä–≥—ñ—ó –¶–ï–ö (–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞ –ï–Ω–µ—Ä–≥–µ—Ç–∏—á–Ω–∞ –ö–æ–º–ø–∞–Ω—ñ—è).

## –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ

- üîç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≥—Ä–∞—Ñ—ñ–∫—ñ–≤ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å –∑–∞ –∞–¥—Ä–µ—Å–æ—é
- üìä –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –≥—Ä–∞—Ñ—ñ–∫—É –Ω–∞ 24 –≥–æ–¥–∏–Ω–∏ (–∫—Ä—É–≥–æ–≤–∞ –¥—ñ–∞–≥—Ä–∞–º–∞)
- ‚ö° **–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –∑ –∫–µ—à—É–≤–∞–Ω–Ω—è–º –≥—Ä—É–ø–∏** - —à–≤–∏–¥—à–∞ –ø–æ–≤—Ç–æ—Ä–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞
- üîî –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏ –∑–º—ñ–Ω—ñ –≥—Ä–∞—Ñ—ñ–∫—É
- ‚ö†Ô∏è –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –∑–∞ N —Ö–≤–∏–ª–∏–Ω –¥–æ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è/–≤–∫–ª—é—á–µ–Ω–Ω—è
- ü§ñ –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ –±–æ—Ç—ñ–≤ (CAPTCHA)
- üíæ –õ–æ–∫–∞–ª—å–Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–∏—Ö SQLite

## –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

### 1. –û—Ç—Ä–∏–º–∞–π—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ [@BotFather](https://t.me/BotFather) –≤ Telegram
2. –°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞ –∫–æ–º–∞–Ω–¥–æ—é `/newbot`
3. –°–∫–æ–ø—ñ—é–π—Ç–µ –æ—Ç—Ä–∏–º–∞–Ω–∏–π —Ç–æ–∫–µ–Ω

### 2. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ

```bash
# –°–∫–æ–ø—ñ—é–π—Ç–µ –ø—Ä–∏–∫–ª–∞–¥ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
cp .env.example .env

# –í—ñ–¥—Ä–µ–¥–∞–≥—É–π—Ç–µ .env —Ç–∞ –≤—Å—Ç–∞–≤—Ç–µ –≤–∞—à —Ç–æ–∫–µ–Ω
nano .env
```

### 3. –ó–∞–ø—É—Å—Ç—ñ—Ç—å –±–æ—Ç–∞

```bash
# –ó –ø–æ—Ç–æ—á–Ω–æ—ó –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó (cek/bot/)
docker-compose up -d

# –ê–±–æ –∑ –∫–æ—Ä–µ–Ω–µ–≤–æ—ó –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó –ø—Ä–æ–µ–∫—Ç—É
cd cek/bot && docker-compose up -d
```

### 4. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å—Ç–∞—Ç—É—Å

```bash
# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ª–æ–≥–∏
docker-compose logs -f cek_bot

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å
docker-compose ps
```

## –ö–æ–º–∞–Ω–¥–∏ –±–æ—Ç–∞

- `/start` –∞–±–æ `/help` - –ü–æ–∫–∞–∑–∞—Ç–∏ –¥–æ–≤—ñ–¥–∫—É
- `/check –ú—ñ—Å—Ç–æ, –í—É–ª–∏—Ü—è, –ë—É–¥–∏–Ω–æ–∫` - –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≥—Ä–∞—Ñ—ñ–∫
- `/check` - –ü–æ–∫—Ä–æ–∫–æ–≤–∏–π –≤–≤—ñ–¥ –∞–¥—Ä–µ—Å–∏
- `/repeat` - –ü–æ–≤—Ç–æ—Ä–∏—Ç–∏ –æ—Å—Ç–∞–Ω–Ω—é –ø–µ—Ä–µ–≤—ñ—Ä–∫—É
- `/subscribe [–≥–æ–¥–∏–Ω–∏]` - –ü—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—è –Ω–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 1 –≥–æ–¥–∏–Ω–∞)
- `/unsubscribe` - –°–∫–∞—Å—É–≤–∞—Ç–∏ –ø—ñ–¥–ø–∏—Å–∫—É
- `/alert [—Ö–≤–∏–ª–∏–Ω–∏]` - –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è (0 = –≤–∏–º–∫–Ω—É—Ç–∏)
- `/cancel` - –°–∫–∞—Å—É–≤–∞—Ç–∏ –ø–æ—Ç–æ—á–Ω—É –¥—ñ—é

## –ü—Ä–∏–∫–ª–∞–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

```
/check –º. –ü–∞–≤–ª–æ–≥—Ä–∞–¥, –≤—É–ª. –ù–æ–≤–∞, 7
/subscribe 2
/alert 15
```

## –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ CEK –±–æ—Ç–∞

### –ö–µ—à—É–≤–∞–Ω–Ω—è –≥—Ä—É–ø–∏
CEK –±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—î –Ω–æ–º–µ—Ä —á–µ—Ä–≥–∏ (–≥—Ä—É–ø–∏) –¥–ª—è –∫–æ–∂–Ω–æ—ó –∞–¥—Ä–µ—Å–∏. –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ñ–π –ø–µ—Ä–µ–≤—ñ—Ä—Ü—ñ —Ç—ñ—î—ó –∂ –∞–¥—Ä–µ—Å–∏ –ø–∞—Ä—Å–µ—Ä –ø—Ä–æ–ø—É—Å–∫–∞—î –∫—Ä–æ–∫ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è —á–µ—Ä–≥–∏, —â–æ –∑–Ω–∞—á–Ω–æ –ø—Ä–∏—Å–∫–æ—Ä—é—î —Ä–æ–±–æ—Ç—É.

### 24-–≥–æ–¥–∏–Ω–Ω–∏–π –≥—Ä–∞—Ñ—ñ–∫
–ù–∞ –≤—ñ–¥–º—ñ–Ω—É –≤—ñ–¥ –î–¢–ï–ö, CEK –ø–æ–∫–∞–∑—É—î –≥—Ä–∞—Ñ—ñ–∫ —Ç—ñ–ª—å–∫–∏ –Ω–∞ –ø–æ—Ç–æ—á–Ω–∏–π –¥–µ–Ω—å (24 –≥–æ–¥–∏–Ω–∏).

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö

–ë–∞–∑–∞ –¥–∞–Ω–∏—Ö –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —É `/data/cek_bot.db` (Docker volume `cek_data`).

–¢–∞–±–ª–∏—Ü—ñ:
- `subscriptions` - –ü—ñ–¥–ø–∏—Å–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (–≤–∫–ª—é—á–∞—î `group_name` –¥–ª—è –∫–µ—à—É–≤–∞–Ω–Ω—è)
- `user_last_check` - –û—Å—Ç–∞–Ω–Ω—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–∂–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–≤–∫–ª—é—á–∞—î `group_name`)

## –û–Ω–æ–≤–ª–µ–Ω–Ω—è

```bash
# –ó—É–ø–∏–Ω–∏—Ç–∏ –±–æ—Ç–∞
docker-compose down

# –û–Ω–æ–≤–∏—Ç–∏ –∫–æ–¥ (git pull –∞–±–æ —ñ–Ω—à–µ)
git pull

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç–∏ —Ç–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–∏
docker-compose up -d --build
```

## –†–µ–∑–µ—Ä–≤–Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è

```bash
# –°—Ç–≤–æ—Ä–∏—Ç–∏ backup –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
docker cp cek_bot:/data/cek_bot.db ./backup_$(date +%Y%m%d).db

# –í—ñ–¥–Ω–æ–≤–∏—Ç–∏ –∑ backup
docker cp ./backup_20231122.db cek_bot:/data/cek_bot.db
```

## –ù–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è

### –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ª–æ–≥–∏
```bash
docker-compose logs -f cek_bot
```

### –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –≤ —Ä–µ–∂–∏–º—ñ —Ä–æ–∑—Ä–æ–±–∫–∏
```bash
# –ó—É–ø–∏–Ω–∏—Ç–∏ Docker –≤–µ—Ä—Å—ñ—é
docker-compose down

# –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
pip install -r ../../requirements.txt

# –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –ª–æ–∫–∞–ª—å–Ω–æ
export CEK_BOT_TOKEN="your_token"
export CEK_DB_PATH="./cek_bot.db"
export CEK_FONT_PATH="../../resources/DejaVuSans.ttf"
python -m cek.bot.bot
```

## –¢–µ—Ö–Ω—ñ—á–Ω—ñ –¥–µ—Ç–∞–ª—ñ

- **Python**: 3.12
- **–§—Ä–µ–π–º–≤–æ—Ä–∫**: aiogram 3.x
- **–ë–∞–∑–∞ –¥–∞–Ω–∏—Ö**: SQLite (aiosqlite)
- **–ü–∞—Ä—Å–µ—Ä**: Playwright (headless Chrome)
- **–í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è**: Pillow (PIL)
- **–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è**: –ö–µ—à—É–≤–∞–Ω–Ω—è –Ω–æ–º–µ—Ä–∞ —á–µ—Ä–≥–∏ –¥–ª—è —à–≤–∏–¥–∫–æ—ó –ø–æ–≤—Ç–æ—Ä–Ω–æ—ó –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏

## –í—ñ–¥–º—ñ–Ω–Ω–æ—Å—Ç—ñ –≤—ñ–¥ –î–¢–ï–ö –±–æ—Ç–∞

| –§—É–Ω–∫—Ü—ñ—è | DTEK | CEK |
|---------|------|-----|
| –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è | 48 –≥–æ–¥–∏–Ω (2 –¥–Ω—ñ) | 24 –≥–æ–¥–∏–Ω–∏ (—Å—å–æ–≥–æ–¥–Ω—ñ) |
| –ö–µ—à—É–≤–∞–Ω–Ω—è | –ù—ñ | –¢–∞–∫ (–Ω–æ–º–µ—Ä —á–µ—Ä–≥–∏) |
| –¢–µ–∫—Å—Ç–æ–≤–∏–π –≥—Ä–∞—Ñ—ñ–∫ | –í—Å—ñ –¥–Ω—ñ | –¢—ñ–ª—å–∫–∏ —Å—å–æ–≥–æ–¥–Ω—ñ |
| –ü–∞—Ä—Å–µ—Ä | dtek_parser | cek_parser |

## –ü—ñ–¥—Ç—Ä–∏–º–∫–∞

–Ø–∫—â–æ –≤–∏–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º–∏:
1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏: `docker-compose logs -f cek_bot`
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ `.env` —Ñ–∞–π–ª
3. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å –±–æ—Ç–∞: `docker-compose restart cek_bot`
5. –Ø–∫—â–æ –ø–∞—Ä—Å–µ—Ä –Ω–µ –ø—Ä–∞—Ü—é—î, –º–æ–∂–ª–∏–≤–æ –∑–º—ñ–Ω–∏–ª–∞—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–∞–π—Ç—É –¶–ï–ö
