services:
  # --- 1. FastAPI Parser API Service ---
  api:
    build:
      context: .
      dockerfile: Dockerfile.parser
    container_name: shutdowns_api
    ports:
      - "8000:8000"
    restart: always

  # --- 2. Telegram Bot Service ---
  bot:
    build:
      context: .
      dockerfile: Dockerfile.bot
    container_name: shutdowns_bot
    env_file:
      - .env
    environment:
      API_BASE_URL: "http://api:8000"
      # Бот обращается к API по имени сервиса внутри сети Docker
      # DB_PATH можно не указывать, так как по умолчанию в коде /data/bot.db
    volumes:
      # --- PRODUCTION: Используем именованный volume ---
      - bot_db:/data
      # --- КОНЕЦ PRODUCTION ---
      # --- DEVELOPMENT (Закомментировано для production) ---
      # - ./data:/data # Привязка локальной папки ./data к /data в контейнере
      # --- КОНЕЦ DEVELOPMENT ---
    depends_on:
      - api
    restart: always

# Определяем volume
volumes:
  bot_db: # name: shutdowns_bot_data # <- Можно задать конкретное имя для volume, если хочется, иначе Docker сам генерирует
