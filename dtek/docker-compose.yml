  # Файл: docker-compose.yml

  services:
    # --- 1. FastAPI Parser API Service ---
    dtek_api:
      build: 
        context: .
        dockerfile: Dockerfile.parser 
      container_name: dtek_api
      ports:
        - "8000:8000"
      restart: always

    # --- 2. Telegram Bot Service ---
    dtek_bot:
      build: 
        context: .
        dockerfile: Dockerfile.bot # Убедитесь, что этот файл существует и содержит VOLUME ["/data"]
      container_name: dtek_bot 
      env_file:
        - .env
      environment:
        # Исправлено: переменная API_BASE_URL, а не DTEK_API_URL
        API_BASE_URL: "http://dtek_api:8000"
        # Бот обращается к API по имени сервиса внутри сети Docker
        DTEK_API_URL: "http://dtek_api:8000/shutdowns"
        # DB_PATH можно не указывать, так как по умолчанию в коде /data/bot.db
        # DB_PATH: "/data/bot.db" # <- Необязательно, если в коде стоит дефолт
      volumes:
        # --- PRODUCTION: Используем именованный volume ---
        - bot_db:/data
        # --- КОНЕЦ PRODUCTION ---
        # --- DEVELOPMENT (Закомментировано для production) ---
        # - .//data # Привязка локальной папки ./data к /data в контейнере
        # --- КОНЕЦ DEVELOPMENT ---
      depends_on:
        - dtek_api
      restart: always

  # Определяем volume
  volumes:
    bot_db:
      # name: dtek_bot_data # <- Можно задать конкретное имя для volume, если хочется, иначе Docker сам генерирует
